C51 COMPILER V9.60.0.0   MAIN                                                              07/08/2024 14:27:49 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "Delay.h"
   3          #include "LCD9648.h"
   4          #include "ST7565.h"
   5          
   6          #include<intrins.h> //因为要用到左右移函数，所以加入这个头文件
   7          typedef unsigned int u16; //对数据类型进行声明定义
   8          typedef unsigned char u8;
   9          
  10          ////修改此值可改变电机旋转速度，不能过大或过小 2-10
  11          
  12          sbit KEY1=P3^0;
  13          sbit KEY2=P3^1;
  14          sbit KEY3=P3^2;
  15          sbit KEY4=P3^3;
  16          
  17           
  18          
  19          int stepmove=0;//步进电机旋转标志位，0为停止，1为旋转
  20          
  21          //typedef unsigned int u16; //对系统默认数据类型进行重定义
  22          //typedef unsigned char u8;
  23          //typedef unsigned long u32;
  24          
  25           //使用宏定义独立按键按下的键值
  26          #define KEY1_PRESS  1
  27          #define KEY2_PRESS  2
  28          #define KEY3_PRESS  3
  29          #define KEY4_PRESS  4
  30          #define KEY_UNPRESS 0
  31          
  32          unsigned char key_scan()
  33          {
  34   1        static u8 key=1;
  35   1      
  36   1      //  if(mode)key=1;//连续扫描按键
  37   1        if(key==1&&(KEY1==0||KEY2==0||KEY3==0||KEY4==0))//任意按键按下
  38   1        {
  39   2          Delay(20);//消抖
  40   2          key=0;
  41   2          if(KEY1==0)
  42   2            return KEY1_PRESS;
  43   2          else if(KEY2==0)
  44   2            return KEY2_PRESS;
  45   2          else if(KEY3==0)
  46   2            return KEY3_PRESS;
  47   2          else if(KEY4==0)
  48   2            return KEY4_PRESS;  
  49   2        }
  50   1        else if(KEY1==1&&KEY2==1&&KEY3==1&&KEY4==1) //无按键按下
  51   1        {
  52   2          key=1;      
  53   2        }
  54   1        return KEY_UNPRESS;   
C51 COMPILER V9.60.0.0   MAIN                                                              07/08/2024 14:27:49 PAGE 2   

  55   1      }
  56          
  57          
  58          
  59          unsigned char Counter,Compare;  //计数值和比较值，用于输出PWM
  60          unsigned char KeyNum,Speed;
  61          
  62          void Timer0_Init(void)
  63          {
  64   1        TMOD &= 0xF0;   //设置定时器模式
  65   1        TMOD |= 0x01;   //设置定时器模式
  66   1        TL0 = 0x9C;   //设置定时初值
  67   1        TH0 = 0xFF;   //设置定时初值
  68   1        TF0 = 0;    //清除TF0标志
  69   1        TR0 = 1;    //定时器0开始计时
  70   1        ET0=1;
  71   1        EA=1;
  72   1        PT0=0;
  73   1      }
  74          
  75          #define SPEEDMAX 20
  76          void Timer0Init(void)   //1毫秒@12.000MHz
  77          {
  78   1      //  AUXR &= 0x7F;   //定时器时钟12T模式
  79   1        TMOD &= 0xF0;   //设置定时器模式
  80   1        TMOD |= 0x01;   //设置定时器模式
  81   1        TL0 = 0x18;   //设置定时初值
  82   1        TH0 = 0xFC;   //设置定时初值
  83   1        TF0 = 0;    //清除TF0标志
  84   1        TR0 = 1;    //定时器0开始计时
  85   1      }
  86          
  87            
  88          
  89          void main()
  90          {
  91   1        u8 key=0;
  92   1        u8 dir=0;
  93   1        u8 step=0;
  94   1        u8 speed=SPEEDMAX;  
  95   1        uchar i = 0;
  96   1        uchar j = 0;
  97   1        int flag=0;
  98   1        int fg=0;
  99   1        
 100   1        LCD_Init();
 101   1        Clear();
 102   1        Timer0_Init();
 103   1        while(1)
 104   1        {
 105   2          
 106   2          
 107   2          if(key==KEY1_PRESS)//按键一按下令步进电机旋转或停止
 108   2            {
 109   3              stepmove=!stepmove;
 110   3            }       
 111   2          
 112   2            if(stepmove==1) //判断是否要让步进电机旋转
 113   2            {
 114   3      //        step_28byj48_control(step++,dir);
 115   3              if(step==8) step=0;
 116   3              Delay(speed);
C51 COMPILER V9.60.0.0   MAIN                                                              07/08/2024 14:27:49 PAGE 3   

 117   3            }
 118   2            
 119   2            if(key==KEY4_PRESS)//按下按键四令步进电机反转 
 120   2            {
 121   3              dir=!dir;     
 122   3            } 
 123   2      //*********步进电机速度控制环节   
 124   2            else if (key==KEY2_PRESS)//按下按键二令步进电机加速se if (key==KEY3_PRESS)  
 125   2            {
 126   3              if(speed>SPEEDMAX)
 127   3                speed-=1;
 128   3            } 
 129   2            {
 130   3      //        if(speed<SPEEDMIN) //按下按键三令步进电机减速
 131   3                speed+=1; 
 132   3            }Delay(SPEEDMAX);//通过每一步的延时来调节步进电机的速度     
 133   2      
 134   2          if(P3_4==0){Delay(20);while(P3_3==0);Delay(20);
 135   3          //flag=0;
 136   3          
 137   3      //      Speed++;
 138   3      //      Speed%=6;
 139   3      //      if(Speed==0){Compare=0;LCD12864_Write16CnCHAR(0,0,"院空空空空空");} //设置比较值，改变PWM占空比
 140   3      //      if(Speed==1){Compare=20;LCD12864_Write16CnCHAR(0,0,"术院空空空空");}
 141   3      //      if(Speed==2){Compare=40;LCD12864_Write16CnCHAR(0,0,"技术院空空空");}
 142   3      //      if(Speed==3){Compare=60;LCD12864_Write16CnCHAR(0,0,"村技术院空空");}
 143   3      //      if(Speed==4){Compare=80;LCD12864_Write16CnCHAR(0,0,"湾村技术院空");}  //设置比较值，改变PWM占空比
 144   3      //      if(Speed==5){Compare=100;LCD12864_Write16CnCHAR(0,0,"林湾村技术院");}
 145   3          
 146   3          
 147   3          
 148   3          }
 149   2      
 150   2          
 151   2          
 152   2          
 153   2                if(P3_1==0)     //如果K2按键按下
 154   2          {
 155   3            flag=0;
 156   3            Delay(20);
 157   3            while(P3_1==0);
 158   3            Delay(20);
 159   3      
 160   3              
 161   3              Clear();
 162   3            while(1){
 163   4            LCD12864_Write16CnCHAR(0,0,"院空空空空空");Compare=10;
 164   4            Delay(100);
 165   4              if(P3_7==0) break;
 166   4            LCD12864_Write16CnCHAR(0,0,"术院空空空空");Compare=30;
 167   4            Delay(100);
 168   4              if(P3_7==0) break;
 169   4            LCD12864_Write16CnCHAR(0,0,"技术院空空空");Compare=40;
 170   4            Delay(100);
 171   4            LCD12864_Write16CnCHAR(0,0,"村技术院空空");Compare=60;
 172   4            Delay(100);
 173   4              if(P3_7==0) break;
 174   4            LCD12864_Write16CnCHAR(0,0,"湾村技术院空");Compare=80;
 175   4            Delay(100);
 176   4              if(P3_7==0) break;
 177   4            LCD12864_Write16CnCHAR(0,0,"林湾村技术院");Compare=100;
 178   4            Delay(100);
C51 COMPILER V9.60.0.0   MAIN                                                              07/08/2024 14:27:49 PAGE 4   

 179   4              if(P3_7==0) break;
 180   4            LCD12864_Write16CnCHAR(0,0,"空林湾村技术");Compare=80;
 181   4            Delay(100);
 182   4              if(P3_7==0) break;
 183   4            LCD12864_Write16CnCHAR(0,0,"空空林湾村技");Compare=60;
 184   4            Delay(100);
 185   4              if(P3_7==0) break;
 186   4            LCD12864_Write16CnCHAR(0,0,"空空空林湾村");Compare=40;
 187   4            Delay(100);
 188   4              if(P3_7==0) break;
 189   4            LCD12864_Write16CnCHAR(0,0,"空空空空林湾");Compare=30;
 190   4            Delay(100);
 191   4              if(P3_7==0) break;
 192   4            LCD12864_Write16CnCHAR(0,0,"空空空空空林"); Compare=20;       
 193   4            Delay(100);
 194   4      
 195   4            if(P3_7==0) break;}
 196   3            
 197   3            
 198   3          }
 199   2          
 200   2          if(P3_5==0)     //如果K5按键按下
 201   2          {
 202   3            Delay(20);
 203   3            while(P3_1==0);
 204   3            Delay(20);
 205   3            flag++;
 206   3          }
 207   2          if(P3_6==0)     //如果K6按键按下
 208   2          {
 209   3            Delay(20);
 210   3            while(P3_1==0);
 211   3            Delay(20);
 212   3            fg++;
 213   3            flag--;
 214   3          }
 215   2          
 216   2          if(P3_7==0||flag==1)      //如果K7按键按下
 217   2          {
 218   3            Delay(20);
 219   3            while(P3_1==0);
 220   3            Delay(20);        
 221   3            
 222   3            //compare=0;
 223   3              LCD12864_Write16CnCHAR(0,0,"设置空空菜单");
 224   3              LCD12864_Write16CnCHAR(0,4,"显示学校？空");
 225   3            flag=1;
 226   3            
 227   3          }
 228   2          
 229   2          if(flag==2){
 230   3          
 231   3          
 232   3            LCD12864_Write16CnCHAR(0,0,"林湾村技术院");
 233   3          LCD12864_Write16CnCHAR(0,4,"显示专业？空"); 
 234   3          
 235   3          }
 236   2          if(flag==3){
 237   3          
 238   3          
 239   3            LCD12864_Write16CnCHAR(0,0,"电子信息空空");
 240   3            LCD12864_Write16CnCHAR(0,4,"显示姓名？空"); 
C51 COMPILER V9.60.0.0   MAIN                                                              07/08/2024 14:27:49 PAGE 5   

 241   3          
 242   3          }
 243   2          if(flag==4){
 244   3          
 245   3          
 246   3            LCD12864_Write16CnCHAR(0,0,"王乙斯空空空");
 247   3            LCD12864_Write16CnCHAR(0,4,"菜单空空空"); 
 248   3          
 249   3          } 
 250   2          if(flag>=5)flag=1;    
 251   2          
 252   2          
 253   2        }
 254   1        
 255   1        
 256   1      }
 257          
 258          
 259          
 260          
 261          
*** WARNING C316 IN LINE 261 OF main.c: unterminated conditionals


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    935    ----
   CONSTANT SIZE    =    232    ----
   XDATA SIZE       =      7      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
