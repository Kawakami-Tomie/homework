C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2024 17:16:19 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "intrins.h"
   3          #include "stdio.h"
   4          
   5          unsigned int count = 0;
   6          
   7          #define BUF_SIZE 2  // 缓冲区大小，用于存储接收到的数据  
   8            
   9          unsigned char rx_buffer[BUF_SIZE];  // 接收缓冲区  
  10          unsigned char rx_index = 0;  // 接收缓冲区索引 
  11          
  12          void Uart1_Init(void) //4800bps@12.000MHz
  13          {
  14   1        
  15   1        PCON |= 0x80;   //使能波特率倍速位SMOD
  16   1        SCON = 0x50;    //8位数据,可变波特率
  17   1        TMOD &= 0x0F;   //设置定时器模式
  18   1        TMOD |= 0x20;   //设置定时器模式
  19   1        TL1 = 0xF3;     //设置定时初始值
  20   1        TH1 = 0xF3;     //设置定时重载值
  21   1        ET1 = 0;      //禁止定时器中断
  22   1        TR1 = 1;      //定时器1开始计时
  23   1        EA = 1;
  24   1        ES = 1;
  25   1      }
  26          void UART_SendByte(unsigned char Byte)
  27          {
  28   1        SBUF=Byte;
  29   1        while(TI==0);
  30   1        TI=0;
  31   1      }
  32          
  33          void Uart_Isr() interrupt 4 using 1
  34          {
  35   1            if (RI) {  // 如果接收到数据  
  36   2              RI = 0;  // 清除接收中断标志位  
  37   2              rx_buffer[rx_index++] = SBUF;  // 将接收到的数据存储到缓冲区中  
  38   2              if (rx_index == BUF_SIZE) {  // 如果接收到了足够的字节  
  39   3                  count=(rx_buffer[0]<<8)+rx_buffer[1];// 
  40   3                  count = (count-2)/3;
  41   3                  UART_SendByte(count);
  42   3                  rx_index = 0;  // 重置缓冲区索引，准备接收下一组数据  
  43   3              }  
  44   2          } 
  45   1      }
  46          
  47          void main()
  48          {
  49   1          Uart1_Init();
  50   1          
  51   1          while(1)
  52   1          {    
  53   2          }
  54   1      }
C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2024 17:16:19 PAGE 2   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    116    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
