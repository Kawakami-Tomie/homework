C51 COMPILER V9.60.0.0   DHT12                                                             07/06/2024 17:00:53 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DHT12
OBJECT MODULE PLACED IN .\Objects\dht12.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE dht12.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\dht12.lst) TABS(2) OBJECT(.\Objects\dht12.obj)

line level    source

   1          #include "dht11.h"
   2          
   3          /**********************************
   4          *函数名：DHT11_start
   5          *函数功能：DHT11开始信号
   6          *输入：无
   7          *输出：无
   8          ***********************************/
   9          void DHT11_start()
  10          {
  11   1         Data = 1;
*** ERROR C202 IN LINE 11 OF dht12.c: 'Data': undefined identifier
  12   1         DelayUs(2);
  13   1         Data = 0;
  14   1         DelayMs(30);  //主机把总线拉低必须大于18毫秒,保证DHT11能检测到起始信号 
  15   1         Data = 1;
  16   1         DelayUs(15); //15*2+5=35us主机发送开始信号结束后,延时等待20-40us后，读取DHT11的响应信号
  17   1      }
  18          
  19          /*******************************************
  20          *函数名：DHT11_rec_byte
  21          *函数功能：接收8位二进制
  22          *输入：无
  23          *输出：dat
  24          **********************************************/
  25          uchar DHT11_rec_byte()      
  26          {
  27   1         uchar i,dat=0;
  28   1         for(i=0;i<8;i++)    
  29   1         {          
  30   2            while(!Data);   //每一bit数据都以50us低电平时隙开始,等待拉高
  31   2            DelayUs(20);    //0-高电平持续26~28us；1-高电平持续116~118us,
  32   2      //此处延时时间过长会死循环，过短读出的数据不正确
  33   2      //(仿真中偏大255，根据仿真情况调整时长；实物中会出现不随环境变化或部分变化的情况)
  34   2            dat <<= 1;        //位读取先高后低   
  35   2            if(Data == 1)    
  36   2               dat += 1;
  37   2            while(Data);     
  38   2          } 
  39   1          return dat;
  40   1      }
  41          /**********************************************
  42          *函数名：DHT11_receive
  43          *函数功能：接收40位的数据
  44          *输入：无
  45          *输出：结构体dht11_t，含温度湿度整数和小数部分
  46          **********************************************/
  47          dht11_t DHT11_receive(void)     
  48          {
  49   1          uchar R_H,R_L,T_H,T_L,revise;
  50   1          dht11_t dht11;  
  51   1          DHT11_start();
  52   1      
  53   1          if(Data == 0)
C51 COMPILER V9.60.0.0   DHT12                                                             07/06/2024 17:00:53 PAGE 2   

  54   1          {
  55   2              while(Data == 0);         //等待DHT11拉高
  56   2              DelayUs(38);          //等待80us DHT11发送数据    
  57   2              R_H=DHT11_rec_byte();     //接收湿度高八位    
  58   2              R_L=DHT11_rec_byte();     //接收湿度低八位    
  59   2              T_H=DHT11_rec_byte();     //接收温度高八位   
  60   2              T_L=DHT11_rec_byte();     //接收温度低八位   
  61   2              revise=DHT11_rec_byte();  //接收校正位          
  62   2              if(revise == (R_H+R_L+T_H+T_L))
  63   2              {       
  64   3              //温度整数部分
  65   3                dht11.temp_i = T_H;                     
  66   3                //温度小数部分
  67   3                dht11.temp_d = T_L;       
  68   3                //湿度整数部分
  69   3                dht11.humi_i = R_H;
  70   3                //湿度小数部分
  71   3                dht11.humi_d = R_L;
  72   3              }
  73   2              DelayUs(23); //拉低总线50us，随后总线由上拉电阻进入空闲状态 
  74   2          }  
  75   1          return dht11;
  76   1      }
  77          ///////////////////////////////////////////////////

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
