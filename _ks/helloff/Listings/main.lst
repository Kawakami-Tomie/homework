C51 COMPILER V9.60.0.0   MAIN                                                              07/07/2024 01:56:30 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include  "DS1302.h"
   3          #include <intrins.h>
   4          #include "Key.h"
   5          #include "BlueTooth.h"
   6          
   7          unsigned char time[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//å
             -®šä¹‰æ•°ç ç®¡ä¸Š0-f  16ä½æ•°å­—çš„æ®µé€‰ç 
   8          unsigned char time_buf[3]={0};//å®šä¹‰æ•°ç ç®¡å¯¹åº”ä½
   9          
  10          #define USART_MAX_RECV_LEN  1
  11          unsigned char USART_RX_BUF[USART_MAX_RECV_LEN];
  12          
  13          unsigned char KeyNum=0,menu=0,MODE=0,TimeSetSelect=1;
  14           /**
  15           *@breaf å»¶æ—¶å‡½æ•°/@12.0000MHz  1msä¸ºå•ä½
  16           *@para   t å»¶æ—¶æ—¶é—´è®¾ç½®
  17           *@retvalæ— 
  18           */
  19          void Delay1ms(unsigned char t)    //@12.0000MHz
  20          {
  21   1        unsigned char i, j;
  22   1        while(t--)
  23   1          {
  24   2          _nop_();
  25   2          i = 2;
  26   2          j = 239;
  27   2          do
  28   2          {
  29   3            while (--j);
  30   3          } while (--i);
  31   2        }
  32   1      }
  33          /**
  34          *@breaf æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°
  35          *@para  æ˜¾ç¤ºçš„æ®µé€‰æ•°æ® æ•°ç»„
  36          *@retvalæ— 
  37          */
  38          void smg_display(unsigned char dat[])
  39          {
  40   1        unsigned char i=0;
  41   1        for(i=0;i<4;i++)//æ‰«æ
  42   1        {
  43   2            switch(i)//ä½é€‰
  44   2          {
  45   3          case 0: P1_0=1; P1_1=0; P1_2=0;P1_3=0;break;
  46   3          case 1: P1_0=0; P1_1=1; P1_2=0;P1_3=0;break;
  47   3          case 2: P1_0=0; P1_1=0; P1_2=1;P1_3=0;break;
  48   3          case 3: P1_0=0; P1_1=0; P1_2=0;P1_3=1;break;  
  49   3          }
  50   2          if((i==1)&&(menu!=0))P0=dat[i]|0x80;
  51   2          else P0=dat[i];//ä¼ é€æ®µé€‰æ•°æ®
  52   2          Delay1ms(1) ;//å»¶æ—¶ä¸€æ®µæ—¶é—´ï¼Œç­‰å¾…æ˜¾ç¤ºç¨³å®š
  53   2          P0=0x00;//æ¶ˆéŸ³
C51 COMPILER V9.60.0.0   MAIN                                                              07/07/2024 01:56:30 PAGE 2   

  54   2        }
  55   1      }
  56          
  57          
  58          
  59          
  60          
  61          //æŒ‰é”®æ‰«æ
  62          void KeyScan(){
  63   1         
  64   1        KeyNum=Key();//è¯»å–é”®ç 
  65   1        if(KeyNum==1){
  66   2          menu++;
  67   2          if(menu>=5) menu=0;
  68   2        }
  69   1        if(menu<3) MODE=0;
  70   1        else if(menu==3) {MODE=1;DS1302_SetTime();}//è®¾ç½® æ—¶ åˆ†
  71   1        else if(menu==4) {MODE=1;DS1302_SetTime();}//è®¾ç½® æœˆ æ—¥
  72   1        
  73   1      }
  74          
  75          void TimeShow(void)//æ—¶é—´æ˜¾ç¤ºåŠŸèƒ½
  76          {
  77   1        DS1302_ReadTime();//è¯»å–æ—¶é—´
  78   1                //æ˜¾ç¤ºå­¦å·
  79   1                if(menu==0){
  80   2                time_buf[0]= time[1];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
  81   2                time_buf[1]= time[7];
  82   2                time_buf[2]= time[8];
  83   2                time_buf[3]= time[0];
  84   2                smg_display(time_buf);
  85   2                }
  86   1                //æ˜¾ç¤º æ—¶ åˆ†
  87   1                else if(menu==1){
  88   2                time_buf[0]= time[DS1302_Time[3]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
  89   2                time_buf[1]= time[DS1302_Time[3]%10];
  90   2                time_buf[2]= time[DS1302_Time[4]/10];
  91   2                time_buf[3]= time[DS1302_Time[4]%10];
  92   2                smg_display(time_buf);
  93   2                }
  94   1                //æ˜¾ç¤º æœˆ æ—¥
  95   1                else if(menu==2){
  96   2                time_buf[0]= time[DS1302_Time[1]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
  97   2                time_buf[1]= time[DS1302_Time[1]%10];
  98   2                time_buf[2]= time[DS1302_Time[2]/10];
  99   2                time_buf[3]= time[DS1302_Time[2]%10];
 100   2                smg_display(time_buf);
 101   2                } 
 102   1      }
 103          
 104          
 105          
 106          
 107          //æ—¶é—´è®¾ç½®åŠŸèƒ½
 108          void TimeSet(void)
 109          {
 110   1        if(KeyNum==2)//æŒ‰é”®2æŒ‰ä¸‹
 111   1        {
 112   2          TimeSetSelect++;//è®¾ç½®é€‰æ‹©ä½åŠ 1
 113   2          if(TimeSetSelect>=5)TimeSetSelect=1;//è¶Šç•Œæ¸…é›¶
 114   2        }
 115   1      
C51 COMPILER V9.60.0.0   MAIN                                                              07/07/2024 01:56:30 PAGE 3   

 116   1        if(KeyNum==3)//æŒ‰é”®3æŒ‰ä¸‹
 117   1        {
 118   2          DS1302_Time[TimeSetSelect]++;//æ—¶é—´è®¾ç½®ä½æ•°å€¼åŠ 1
 119   2        
 120   2          if(DS1302_Time[1]>12){DS1302_Time[1]=1;}//æœˆè¶Šç•Œåˆ¤æ–­
 121   2          if( DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || 
 122   2            DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)//æ—¥è¶Šç•Œåˆ¤æ–­
 123   2          {
 124   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}//å¤§æœˆ
 125   3          }
 126   2          else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 127   2          {
 128   3            if(DS1302_Time[2]>30){DS1302_Time[2]=1;}//å°æœˆ
 129   3          }
 130   2          else if(DS1302_Time[1]==2)
 131   2          {
 132   3            if(DS1302_Time[0]%4==0)
 133   3            {
 134   4              if(DS1302_Time[2]>29){DS1302_Time[2]=1;}//é—°å¹´2æœˆ
 135   4            }
 136   3            else
 137   3            {
 138   4              if(DS1302_Time[2]>28){DS1302_Time[2]=1;}//å¹³å¹´2æœˆ
 139   4            }
 140   3          }
 141   2          if(DS1302_Time[3]>23){DS1302_Time[3]=0;}//æ—¶è¶Šç•Œåˆ¤æ–­
 142   2          if(DS1302_Time[4]>59){DS1302_Time[4]=0;}//åˆ†è¶Šç•Œåˆ¤æ–­
 143   2          
 144   2        }
 145   1        if(KeyNum==4)//æŒ‰é”®3æŒ‰ä¸‹
 146   1        {
 147   2          DS1302_Time[TimeSetSelect]--;//æ—¶é—´è®¾ç½®ä½æ•°å€¼å‡1
 148   2          
 149   2          if(DS1302_Time[1]<1){DS1302_Time[1]=12;}//æœˆè¶Šç•Œåˆ¤æ–­
 150   2          if( DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || 
 151   2            DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)//æ—¥è¶Šç•Œåˆ¤æ–­
 152   2          {
 153   3            if(DS1302_Time[2]<1){DS1302_Time[2]=31;}//å¤§æœˆ
 154   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
 155   3          }
 156   2          else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 157   2          {
 158   3            if(DS1302_Time[2]<1){DS1302_Time[2]=30;}//å°æœˆ
 159   3            if(DS1302_Time[2]>30){DS1302_Time[2]=1;}
 160   3          }
 161   2          else if(DS1302_Time[1]==2)
 162   2          {
 163   3            if(DS1302_Time[0]%4==0)
 164   3            {
 165   4              if(DS1302_Time[2]<1){DS1302_Time[2]=29;}//é—°å¹´2æœˆ
 166   4              if(DS1302_Time[2]>29){DS1302_Time[2]=1;}
 167   4            }
 168   3            else
 169   3            {
 170   4              if(DS1302_Time[2]<1){DS1302_Time[2]=28;}//å¹³å¹´2æœˆ
 171   4              if(DS1302_Time[2]>28){DS1302_Time[2]=1;}
 172   4            }
 173   3          }
 174   2          if(DS1302_Time[3]<0){DS1302_Time[3]=23;}//æ—¶è¶Šç•Œåˆ¤æ–­
 175   2          if(DS1302_Time[4]<0){DS1302_Time[4]=59;}//åˆ†è¶Šç•Œåˆ¤æ–­
 176   2          
 177   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              07/07/2024 01:56:30 PAGE 4   

 178   1      }
 179          
 180          void TimeChange(void)
 181          {
 182   1               //è®¾ç½® æ—¶ åˆ†
 183   1               if(menu==3){
 184   2                TimeSet();
 185   2                time_buf[0]= time[DS1302_Time[3]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
 186   2                time_buf[1]= time[DS1302_Time[3]%10];
 187   2                time_buf[2]= time[DS1302_Time[4]/10];
 188   2                time_buf[3]= time[DS1302_Time[4]%10];
 189   2                smg_display(time_buf);
 190   2                }
 191   1                //è®¾ç½® æœˆ æ—¥
 192   1                else if(menu==4){
 193   2                TimeSet();
 194   2                time_buf[0]= time[DS1302_Time[1]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
 195   2                time_buf[1]= time[DS1302_Time[1]%10];
 196   2                time_buf[2]= time[DS1302_Time[2]/10];
 197   2                time_buf[3]= time[DS1302_Time[2]%10];
 198   2                smg_display(time_buf);
 199   2                }
 200   1      
 201   1      }
 202           
 203          void main ()
 204          { 
 205   1          UART_Init();//åˆå§‹åŒ–è“ç‰™
 206   1          DS1302_Init();//DS1302åˆå§‹åŒ–
 207   1          DS1302_SetTime();// DS1302è®¾ç½®æ—¶é—´
 208   1          while(1)
 209   1          {
 210   2                KeyScan();
 211   2                switch(MODE)//æ ¹æ®ä¸åŒçš„åŠŸèƒ½æ‰§è¡Œä¸åŒçš„å‡½æ•°
 212   2                    {
 213   3                      case 0:TimeShow();break;
 214   3                      case 1:TimeChange();break;
 215   3                    }         
 216   2            
 217   2            }
 218   1      }
 219          
 220          //ä¸²å£ä¸­æ–­å‡½æ•°
 221          void Uart() interrupt 4
 222          {
 223   1        if(RI)
 224   1        {
 225   2          USART_RX_BUF[0]=SBUF;
 226   2          RI = 0;//æ¸…é™¤æ¥æ”¶ä¸­æ–­æ ‡å¿—ä½
 227   2        }                
 228   1      }
 229          
 230           
 231            
 232            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    959    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              07/07/2024 01:56:30 PAGE 5   

   DATA SIZE        =     24       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
