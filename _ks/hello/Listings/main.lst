C51 COMPILER V9.60.0.0   MAIN                                                              07/06/2024 21:38:32 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include  "DS1302.h"
   3          #include <intrins.h>
   4          #include "Key.h"
   5          #include "BlueTooth.h"
   6          
   7          unsigned char time[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//å
             -®šä¹‰æ•°ç ç®¡ä¸Š0-f  16ä½æ•°å­—çš„æ®µé€‰ç 
   8          unsigned char time_buf[3]={0};//å®šä¹‰æ•°ç ç®¡å¯¹åº”ä½
   9          
  10          #define USART_MAX_RECV_LEN  1
  11          
  12          unsigned char USART_RX_BUF[USART_MAX_RECV_LEN];
  13          
  14          unsigned char KeyNum=0,menu=0,MODE=0,TimeSetSelect=1;
  15           /**
  16           *@breaf å»¶æ—¶å‡½æ•°/@12.0000MHz  1msä¸ºå•ä½
  17           *@para   t å»¶æ—¶æ—¶é—´è®¾ç½®
  18           *@retvalæ— 
  19           */
  20          void Delay1ms(unsigned char t)    //@12.0000MHz
  21          {
  22   1        unsigned char i, j;
  23   1        while(t--)
  24   1          {
  25   2          _nop_();
  26   2          i = 2;
  27   2          j = 239;
  28   2          do
  29   2          {
  30   3            while (--j);
  31   3          } while (--i);
  32   2        }
  33   1      }
  34          /**
  35          *@breaf æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°
  36          *@para  æ˜¾ç¤ºçš„æ®µé€‰æ•°æ® æ•°ç»„
  37          *@retvalæ— 
  38          */
  39          void smg_display(unsigned char dat[])
  40          {
  41   1        unsigned char i=0;
  42   1        for(i=0;i<4;i++)//æ‰«æ
  43   1        {
  44   2            switch(i)//ä½é€‰
  45   2          {
  46   3          case 0: P1_0=1; P1_1=0; P1_2=0;P1_3=0;break;
  47   3          case 1: P1_0=0; P1_1=1; P1_2=0;P1_3=0;break;
  48   3          case 2: P1_0=0; P1_1=0; P1_2=1;P1_3=0;break;
  49   3          case 3: P1_0=0; P1_1=0; P1_2=0;P1_3=1;break;  
  50   3          }
  51   2          if((i==1)&&(menu!=0))P0=dat[i]|0x80;
  52   2          else P0=dat[i];//ä¼ é€æ®µé€‰æ•°æ®
  53   2          Delay1ms(1) ;//å»¶æ—¶ä¸€æ®µæ—¶é—´ï¼Œç­‰å¾…æ˜¾ç¤ºç¨³å®š
C51 COMPILER V9.60.0.0   MAIN                                                              07/06/2024 21:38:32 PAGE 2   

  54   2          P0=0x00;//æ¶ˆéŸ³
  55   2        }
  56   1      }
  57          
  58          
  59          
  60          
  61          
  62          //æŒ‰é”®æ‰«æ
  63          void KeyScan(){
  64   1         
  65   1        KeyNum=Key();//è¯»å–é”®ç 
  66   1            
  67   1        if(KeyNum==1){
  68   2          menu++;
  69   2          if(menu>=5) menu=0;
  70   2        }
  71   1        if(menu<3) MODE=0;
  72   1        else if(menu==3) {MODE=1;DS1302_SetTime();}//è®¾ç½® æ—¶ åˆ†
  73   1        else if(menu==4) {MODE=1;DS1302_SetTime();}//è®¾ç½® æœˆ æ—¥
  74   1        
  75   1      
  76   1      }
  77          
  78          void TimeShow(void)//æ—¶é—´æ˜¾ç¤ºåŠŸèƒ½
  79          {
  80   1        DS1302_ReadTime();//è¯»å–æ—¶é—´
  81   1                //æ˜¾ç¤ºå­¦å·
  82   1                if(menu==0){
  83   2                time_buf[0]= time[1];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
  84   2                time_buf[1]= time[7];
  85   2                time_buf[2]= time[8];
  86   2                time_buf[3]= time[0];
  87   2                smg_display(time_buf);
  88   2                }
  89   1                //æ˜¾ç¤º æ—¶ åˆ†
  90   1                else if(menu==1){
  91   2                time_buf[0]= time[DS1302_Time[3]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
  92   2                time_buf[1]= time[DS1302_Time[3]%10];
  93   2                time_buf[2]= time[DS1302_Time[4]/10];
  94   2                time_buf[3]= time[DS1302_Time[4]%10];
  95   2                smg_display(time_buf);
  96   2                }
  97   1                //æ˜¾ç¤º æœˆ æ—¥
  98   1                else if(menu==2){
  99   2                time_buf[0]= time[DS1302_Time[1]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
 100   2                time_buf[1]= time[DS1302_Time[1]%10];
 101   2                time_buf[2]= time[DS1302_Time[2]/10];
 102   2                time_buf[3]= time[DS1302_Time[2]%10];
 103   2                smg_display(time_buf);
 104   2                } 
 105   1      }
 106          
 107          
 108          
 109          
 110          //æ—¶é—´è®¾ç½®åŠŸèƒ½
 111          void TimeSet(void)
 112          {
 113   1        if(KeyNum==2)//æŒ‰é”®2æŒ‰ä¸‹
 114   1        {
 115   2          TimeSetSelect++;//è®¾ç½®é€‰æ‹©ä½åŠ 1
C51 COMPILER V9.60.0.0   MAIN                                                              07/06/2024 21:38:32 PAGE 3   

 116   2          if(TimeSetSelect>=5)TimeSetSelect=1;//è¶Šç•Œæ¸…é›¶
 117   2        }
 118   1      
 119   1        if(KeyNum==3)//æŒ‰é”®3æŒ‰ä¸‹
 120   1        {
 121   2          DS1302_Time[TimeSetSelect]++;//æ—¶é—´è®¾ç½®ä½æ•°å€¼åŠ 1
 122   2        
 123   2          if(DS1302_Time[1]>12){DS1302_Time[1]=1;}//æœˆè¶Šç•Œåˆ¤æ–­
 124   2          if( DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || 
 125   2            DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)//æ—¥è¶Šç•Œåˆ¤æ–­
 126   2          {
 127   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}//å¤§æœˆ
 128   3          }
 129   2          else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 130   2          {
 131   3            if(DS1302_Time[2]>30){DS1302_Time[2]=1;}//å°æœˆ
 132   3          }
 133   2          else if(DS1302_Time[1]==2)
 134   2          {
 135   3            if(DS1302_Time[0]%4==0)
 136   3            {
 137   4              if(DS1302_Time[2]>29){DS1302_Time[2]=1;}//é—°å¹´2æœˆ
 138   4            }
 139   3            else
 140   3            {
 141   4              if(DS1302_Time[2]>28){DS1302_Time[2]=1;}//å¹³å¹´2æœˆ
 142   4            }
 143   3          }
 144   2          if(DS1302_Time[3]>23){DS1302_Time[3]=0;}//æ—¶è¶Šç•Œåˆ¤æ–­
 145   2          if(DS1302_Time[4]>59){DS1302_Time[4]=0;}//åˆ†è¶Šç•Œåˆ¤æ–­
 146   2          
 147   2        }
 148   1        if(KeyNum==4)//æŒ‰é”®3æŒ‰ä¸‹
 149   1        {
 150   2          DS1302_Time[TimeSetSelect]--;//æ—¶é—´è®¾ç½®ä½æ•°å€¼å‡1
 151   2          
 152   2          if(DS1302_Time[1]<1){DS1302_Time[1]=12;}//æœˆè¶Šç•Œåˆ¤æ–­
 153   2          if( DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || 
 154   2            DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)//æ—¥è¶Šç•Œåˆ¤æ–­
 155   2          {
 156   3            if(DS1302_Time[2]<1){DS1302_Time[2]=31;}//å¤§æœˆ
 157   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
 158   3          }
 159   2          else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 160   2          {
 161   3            if(DS1302_Time[2]<1){DS1302_Time[2]=30;}//å°æœˆ
 162   3            if(DS1302_Time[2]>30){DS1302_Time[2]=1;}
 163   3          }
 164   2          else if(DS1302_Time[1]==2)
 165   2          {
 166   3            if(DS1302_Time[0]%4==0)
 167   3            {
 168   4              if(DS1302_Time[2]<1){DS1302_Time[2]=29;}//é—°å¹´2æœˆ
 169   4              if(DS1302_Time[2]>29){DS1302_Time[2]=1;}
 170   4            }
 171   3            else
 172   3            {
 173   4              if(DS1302_Time[2]<1){DS1302_Time[2]=28;}//å¹³å¹´2æœˆ
 174   4              if(DS1302_Time[2]>28){DS1302_Time[2]=1;}
 175   4            }
 176   3          }
 177   2          if(DS1302_Time[3]<0){DS1302_Time[3]=23;}//æ—¶è¶Šç•Œåˆ¤æ–­
C51 COMPILER V9.60.0.0   MAIN                                                              07/06/2024 21:38:32 PAGE 4   

 178   2          if(DS1302_Time[4]<0){DS1302_Time[4]=59;}//åˆ†è¶Šç•Œåˆ¤æ–­
 179   2          
 180   2        }
 181   1      }
 182          
 183          void TimeChange(void)
 184          {
 185   1               //è®¾ç½® æ—¶ åˆ†
 186   1               if(menu==3){
 187   2                TimeSet();
 188   2                time_buf[0]= time[DS1302_Time[3]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
 189   2                time_buf[1]= time[DS1302_Time[3]%10];
 190   2                time_buf[2]= time[DS1302_Time[4]/10];
 191   2                time_buf[3]= time[DS1302_Time[4]%10];
 192   2                smg_display(time_buf);
 193   2                }
 194   1                //è®¾ç½® æœˆ æ—¥
 195   1                else if(menu==4){
 196   2                TimeSet();
 197   2                time_buf[0]= time[DS1302_Time[1]/10];//å°†BCDç è½¬ä¸ºåè¿›åˆ¶
 198   2                time_buf[1]= time[DS1302_Time[1]%10];
 199   2                time_buf[2]= time[DS1302_Time[2]/10];
 200   2                time_buf[3]= time[DS1302_Time[2]%10];
 201   2                smg_display(time_buf);
 202   2                }
 203   1      
 204   1      }
 205           
 206          void main ()
 207          { 
 208   1          UART_Init();//åˆå§‹åŒ–è“ç‰™
 209   1          DS1302_Init();//DS1302åˆå§‹åŒ–
 210   1          DS1302_SetTime();// DS1302è®¾ç½®æ—¶é—´
 211   1          while(1)
 212   1          {
 213   2                KeyScan();
 214   2                switch(MODE)//æ ¹æ®ä¸åŒçš„åŠŸèƒ½æ‰§è¡Œä¸åŒçš„å‡½æ•°
 215   2                    {
 216   3                      case 0:TimeShow();break;
 217   3                      case 1:TimeChange();break;
 218   3                    }         
 219   2            
 220   2            }
 221   1      }
 222          
 223          //ä¸²å£ä¸­æ–­å‡½æ•°
 224          void Uart1_Isr() interrupt 4
 225          {
 226   1        if(RI)
 227   1        {
 228   2          USART_RX_BUF[0]=SBUF;
 229   2          RI = 0;//æ¸…é™¤æ¥æ”¶ä¸­æ–­æ ‡å¿—ä½
 230   2          UART_SendByte(SBUF);
 231   2      //    if(SBUF == 0xB1 || SBUF == 0xB9) KeyNum = 1;  
 232   2      //    else if(SBUF == 0xB2 || SBUF == 0xBA) KeyNum = 2;  
 233   2      //    else if(SBUF == 0xB3 || SBUF == 0xBB) KeyNum = 3;  
 234   2      //    else if(SBUF == 0xB4 || SBUF == 0xBC) KeyNum = 4;    
 235   2      //    else { KeyNum = 1;} 
 236   2          RI=0;
 237   2        }                
 238   1      }
 239          
C51 COMPILER V9.60.0.0   MAIN                                                              07/06/2024 21:38:32 PAGE 5   

 240          
 241          
 242          
 243            
 244            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1021    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
